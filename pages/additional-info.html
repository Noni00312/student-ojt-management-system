<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/additional-info.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/bootstrap-icons.min.css" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/assets/img/icons/LOGO 96.png" />
    <link rel="app-mobile-web-app-status-bar" href="#9CCD62" />
    <meta name="theme-color" content="#748E54" />
    <script src="../js/prevent-back.js"></script>
    <title>SOJTMS - Register</title>
  </head>
  <body>
    <div
      id="register-body"
      class="container mt-3 d-flex align-items-center justify-content-center flex-column"
    >
      <div
        id="register-icon-container "
        class="logo-wrapper register-icon-container d-flex justify-content-center align-items-center"
      >
        <img
          id="register-icon"
          src="/assets/img/logo trans.png"
          alt="logo"
          width="120px"
          height="120px"
        />
        <h1 class="p-3 fs-5">Personal information</h1>
      </div>

      <div id="register-card" class="px-5 py-sm-3 d-flex flex-column">
        <form action="" method="post" id="additional-info-form">
          <div class="row pt-2">
            <input type="text" id="user-id" name="userId" value="" hidden />
            <input
              type="text"
              id="user-type"
              name="userType"
              value="student"
              hidden
            />
            <!-- <input type="text" id="company-address" name="companyAddress" value="" hidden> -->

            <div
              class="form-floating col-md-6 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-person-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="text"
                class="form-control ps-3 pe-1"
                id="student-id"
                name="studentId"
                placeholder="Enter your student id"
              />
              <label for="student-id">Student ID</label>
              <span
                id="studentId-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-6 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-telephone-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="tel"
                class="form-control ps-3 pe-1"
                id="phone-number"
                placeholder="Enter your Phone Number"
                name="phoneNumber"
              />
              <label for="phone-number">Phone Number</label>
              <span
                id="phoneNumber-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-3 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-person-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="text"
                class="form-control ps-3 pe-1"
                id="first-name"
                placeholder="Enter your first name"
                name="firstName"
              />
              <label for="first-name">First Name</label>
              <span
                id="firstName-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-3 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-person-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="text"
                class="form-control ps-3 pe-1"
                id="middle-name"
                placeholder="Enter your middle name"
                name="middleName"
              />
              <label for="middle-name">Middle Name</label>
              <span
                id="middleName-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-3 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-person-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="text"
                class="form-control ps-3 pe-1"
                id="last-name"
                placeholder="Enter your last name"
                name="lastName"
              />
              <label for="last-name">Last Name</label>
              <span
                id="lastName-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-3 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-person-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="text"
                class="form-control ps-3 pe-1"
                id="sufix"
                placeholder="Enter your suffix"
                name="suffix"
              />
              <label for="sufix">Suffix</label>
            </div>

            <div
              class="form-floating col-md-6 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-gender-ambiguous position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <select
                class="form-select"
                style="background-image: none !important"
                id="gender"
                aria-label="Floating label select example"
                name="gender"
              >
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
              <label for="gender">Gender</label>
              <span
                id="gender-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-6 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-geo-alt-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <input
                type="text"
                class="form-control ps-3 pe-1"
                id="address"
                placeholder="Enter your Address"
                name="address"
              />
              <label for="address">Address</label>
              <span
                id="address-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div
              class="form-floating col-md-12 mb-3 ps-1 pe-1 position-relative"
            >
              <i
                id="user-icon"
                class="bi bi-buildings-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
                style="color: #3c3d42 !important"
              ></i>
              <select
                class="form-select"
                style="background-image: none !important"
                id="company-name"
                aria-label="Floating label select example"
                name="companyName"
              >
                <option value=""></option>
                <option value="male">DAR</option>
                <option value="female">DOST</option>
              </select>
              <label for="company-name">Company name</label>

              <span
                id="companyName-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div class="col-md-12 d-flex flex-column mb-3 p-0">
              <label for="weekday">Weekly schedule</label>
              <div
                class="weekdays-container d-flex align-items-center flex-wrap gap-1 justify-content-between mt-2"
              >
                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="monday"
                    value="MON"
                    class=""
                  />
                  <label for="monday">MON</label>
                </span>

                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="tuesday"
                    value="TUES"
                    class=""
                  />
                  <label for="tuesday">TUES</label>
                </span>

                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="wednesday"
                    value="WED"
                    class=""
                  />
                  <label for="wednesday">WED</label>
                </span>
                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="thursday"
                    value="THURS"
                    class=""
                  />
                  <label for="thursday">THURS</label>
                </span>
                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="friday"
                    value="FRI"
                    class=""
                  />
                  <label for="friday">FRI</label>
                </span>

                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="saturday"
                    value="SAT"
                    class=""
                  />
                  <label for="saturday">SAT</label>
                </span>

                <span id="weekday">
                  <input
                    type="checkbox"
                    name="weeklySchedule[]"
                    id="sunday"
                    value="SUN"
                    class=""
                  />
                  <label for="sunday">SUN</label>
                </span>
              </div>
              <span
                id="weeklySchedule-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div class="form-floating col-md-3 ps-1 pe-1 position-relative">
              <i
                class="bi bi-clock-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
              ></i>
              <input
                type="time"
                class="form-control ps-3 pe-1"
                id="morning-time-in"
                name="morningTimeIn"
              />
              <label for="morning-time-in">Morning - Time in</label>
              <span
                id="morningTimeIn-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div class="form-floating col-md-3 ps-1 pe-1 position-relative">
              <i
                class="bi bi-clock-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
              ></i>
              <input
                type="time"
                class="form-control ps-3 pe-1"
                id="morning-time-out"
                name="morningTimeOut"
              />
              <label for="morning-time-out">Morning - Time out</label>
              <span
                id="morningTimeOut-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div class="form-floating col-md-3 ps-1 pe-1 position-relative">
              <i
                class="bi bi-clock-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
              ></i>
              <input
                type="time"
                class="form-control ps-3 pe-1"
                id="afternoon-time-in"
                name="afternoonTimeIn"
              />
              <label for="afternoon-time-in">Afternoon - Time in</label>
              <span
                id="afternoonTimeIn-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div class="form-floating col-md-3 ps-1 pe-1 position-relative">
              <i
                class="bi bi-clock-fill position-absolute top-50 end-0 me-3 translate-middle-y ms-3"
              ></i>
              <input
                type="time"
                class="form-control ps-3 pe-1"
                id="afternoon-time-out"
                name="afternoonTimeOut"
              />
              <label for="afternoon-time-out">Afternoon - Time out</label>
              <span
                id="afternoonTimeOut-error"
                class="text-danger"
                style="font-size: 12px"
              ></span>
            </div>

            <div class="p-0 mt-3 image-upload-container">
              <img
                src="../assets/img/icons8_male_user_480px_1.png"
                width="48px"
                height="48px"
                id="preview-img"
              />
              <div class="file-dialog">
                <input
                  class="form-control form-control-lg"
                  id="img-input"
                  type="file"
                  name="userImg"
                  accept="image/*"
                />
              </div>
            </div>
          </div>

          <button
            class="mt-4 mb-3 d-block w-100"
            id="personal-info-submit"
            type="submit"
            value="submit"
          >
            <span>Create Account</span>
          </button>
        </form>

        <!-- <a id="login-link" href="/pages/login.html">Already have an account? Sign In</a> -->
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="/js/jQuery.js"></script>
    <script src="/js/jquery.validate.min.js"></script>
    <script type="module" src="/js/firebase-config.js"></script>
    <script src="/js/image-handler.js"></script>
    <script src="/js/register-validation.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/ui.js"></script>

    <script type="module">
      import { getAuth, onAuthStateChanged } from "../js/firebase-config.js";
      const auth = getAuth();

      function protectPersonalInfoPage() {
        const body = document.body;

        const loadingIndicator = document.createElement("div");
        loadingIndicator.innerHTML = `
            <div class="d-flex justify-content-center align-items-center" style="height: 100vh; z-index: 1000;">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          `;
        body.appendChild(loadingIndicator);

        onAuthStateChanged(auth, (user) => {
          if (!user || !user.emailVerified) {
            window.location.href = "/pages/login.html";
            return;
          }

          body.removeChild(loadingIndicator);

          const userIdInput = document.getElementById("user-id");

          if (userIdInput) {
            userIdInput.value = user.uid;
          } else {
            console.error("Element with ID 'user-id' not found");
            const newInput = document.createElement("input");
            newInput.type = "hidden";
            newInput.id = "user-id";
            newInput.value = user.uid;
            body.appendChild(newInput);
          }
        });
      }

      const fileInput = document.getElementById("img-input");
      fileInput.addEventListener("change", function (e) {
        const preview = document.getElementById("preview-img");

        if (this.files && this.files[0]) {
          const selectedFile = this.files[0];
          const reader = new FileReader();

          reader.onload = function (e) {
            preview.src = e.target.result;
            // preview.style.display = "block";
          };

          reader.readAsDataURL(selectedFile);
        } else {
          preview.src = "../assets/img/icons8_male_user_480px_1.png";
        }
      });

      document.addEventListener("DOMContentLoaded", protectPersonalInfoPage);
    </script>
  </body>
</html>
